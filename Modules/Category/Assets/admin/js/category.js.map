{"version":3,"file":"/Modules/Category/Assets/admin/js/category.js","mappings":"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","sources":["webpack://fleetcart/./Modules/Category/Resources/assets/admin/js/CategoryTree.js","webpack://fleetcart/./Modules/Category/Resources/assets/admin/js/main.js","webpack://fleetcart/./Modules/Category/Resources/assets/admin/js/CategoryForm.js"],"sourcesContent":["export default class {\r\n    constructor(categoryForm, selector) {\r\n        this.selector = selector;\r\n\r\n        $.jstree.defaults.dnd.touch = true;\r\n        $.jstree.defaults.dnd.copy = false;\r\n\r\n        this.fetchCategoryTree();\r\n\r\n        // On selecting a category.\r\n        selector.on('select_node.jstree', (e, node) => categoryForm.fetchCategory(node.selected[0]));\r\n\r\n        // Expand categories when jstree is loaded.\r\n        selector.on('loaded.jstree', () => selector.jstree('open_all'));\r\n\r\n        // On updating category tree.\r\n        this.selector.on('move_node.jstree', (e, data) => {\r\n            this.updateCategoryTree(data);\r\n        });\r\n    }\r\n\r\n    fetchCategoryTree() {\r\n        this.selector.jstree({\r\n            core: {\r\n                data: { url: route('admin.categories.tree') },\r\n                check_callback: true,\r\n            },\r\n            plugins: ['dnd'],\r\n        });\r\n    }\r\n\r\n    updateCategoryTree(data) {\r\n        this.loading(data.node, true);\r\n\r\n        $.ajax({\r\n            type: 'PUT',\r\n            url: route('admin.categories.tree.update'),\r\n            data: { category_tree: this.getCategoryTree() },\r\n            success: (message) => {\r\n                success(message);\r\n\r\n                this.loading(data.node, false);\r\n            },\r\n            error: (xhr) => {\r\n                error(xhr.responseJSON.message);\r\n\r\n                this.loading(data.node, false);\r\n            },\r\n        });\r\n    }\r\n\r\n    getCategoryTree() {\r\n        let categories = this.selector.jstree(true).get_json('#', { flat: true });\r\n\r\n        return categories.reduce((formatted, category) => {\r\n            return formatted.concat({\r\n                id: category.id,\r\n                parent_id: (category.parent === '#') ? null : category.parent,\r\n                position: category.data.position,\r\n            });\r\n        }, []);\r\n    }\r\n\r\n    loading(node, state) {\r\n        let nodeElement = this.selector.jstree().get_node(node, true);\r\n\r\n        if (state) {\r\n            $(nodeElement).addClass('jstree-loading');\r\n        } else {\r\n            $(nodeElement).removeClass('jstree-loading');\r\n        }\r\n    }\r\n}\r\n","import CategoryForm from './CategoryForm';\r\n\r\nnew CategoryForm();\r\n","import CategoryTree from './CategoryTree';\r\n\r\nexport default class {\r\n    constructor() {\r\n        let tree = $('.category-tree');\r\n\r\n        new CategoryTree(this, tree);\r\n\r\n        this.collapseAll(tree);\r\n        this.expandAll(tree);\r\n        this.addRootCategory();\r\n        this.addSubCategory();\r\n\r\n        $('#category-form').on('submit', this.submit);\r\n\r\n        window.admin.removeSubmitButtonOffsetOn('#image', '.category-details-tab li > a');\r\n    }\r\n\r\n    collapseAll(tree) {\r\n        $('.collapse-all').on('click', (e) => {\r\n            e.preventDefault();\r\n\r\n            tree.jstree('close_all');\r\n        });\r\n    }\r\n\r\n    expandAll(tree) {\r\n        $('.expand-all').on('click', (e) => {\r\n            e.preventDefault();\r\n\r\n            tree.jstree('open_all');\r\n        });\r\n    }\r\n\r\n    addRootCategory() {\r\n        $('.add-root-category').on('click', () => {\r\n            this.loading(true);\r\n\r\n            $('.add-sub-category').addClass('disabled');\r\n\r\n            $('.category-tree').jstree('deselect_all');\r\n\r\n            this.clear();\r\n\r\n            // Intentionally delay 150ms so that user feel new form is loaded.\r\n            setTimeout(this.loading, 150, false);\r\n        });\r\n    }\r\n\r\n    addSubCategory() {\r\n        $('.add-sub-category').on('click', () => {\r\n            let selectedId = $('.category-tree').jstree('get_selected')[0];\r\n\r\n            if (selectedId === undefined) {\r\n                return;\r\n            }\r\n\r\n            this.clear();\r\n            this.loading(true);\r\n\r\n            window.form.appendHiddenInput('#category-form', 'parent_id', selectedId);\r\n\r\n            // Intentionally delay 150ms so that user feel new form is loaded.\r\n            setTimeout(this.loading, 150, false);\r\n        });\r\n    }\r\n\r\n    fetchCategory(id) {\r\n        this.loading(true);\r\n\r\n        $('.add-sub-category').removeClass('disabled');\r\n\r\n        $.ajax({\r\n            type: 'GET',\r\n            url: route('admin.categories.show', id),\r\n            success: (category) => {\r\n                this.update(category);\r\n\r\n                this.loading(false);\r\n            },\r\n            error: (xhr) => {\r\n                error(xhr.responseJSON.message);\r\n\r\n                this.loading(false);\r\n            },\r\n        });\r\n    }\r\n\r\n    update(category) {\r\n        window.form.removeErrors();\r\n\r\n        $('.btn-delete').removeClass('hide');\r\n        $('.form-group .help-block').remove();\r\n\r\n        $('#confirmation-form').attr('action', route('admin.categories.destroy', category.id));\r\n\r\n        $('#id-field').removeClass('hide');\r\n\r\n        $('#id').val(category.id);\r\n        $('#name').val(category.name);\r\n\r\n        $('#slug').val(category.slug);\r\n        $('#slug-field').removeClass('hide');\r\n        $('.category-details-tab .seo-tab').removeClass('hide');\r\n\r\n        $('#is_searchable').prop('checked', category.is_searchable);\r\n        $('#is_active').prop('checked', category.is_active);\r\n\r\n        $('.logo .image-holder-wrapper').html(this.categoryImage('logo', category.logo));\r\n        $('.banner .image-holder-wrapper').html(this.categoryImage('banner', category.banner));\r\n\r\n        $('#category-form input[name=\"parent_id\"]').remove();\r\n    }\r\n\r\n    categoryImage(fieldName, file) {\r\n        if (! file.exists) {\r\n            return this.imagePlaceholder();\r\n        }\r\n\r\n        return `\r\n            <div class=\"image-holder\">\r\n                <img src=\"${file.path}\">\r\n                <button type=\"button\" class=\"btn remove-image\" data-input-name=\"files[${fieldName}]\"></button>\r\n                <input type=\"hidden\" name=\"files[${fieldName}]\" value=\"${file.id}\">\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    clear() {\r\n        $('#id-field').addClass('hide');\r\n\r\n        $('#id').val('');\r\n        $('#name').val('');\r\n\r\n        $('#slug').val('');\r\n        $('#slug-field').addClass('hide');\r\n        $('.category-details-tab .seo-tab').addClass('hide');\r\n\r\n        $('#is_searchable').prop('checked', false);\r\n        $('#is_active').prop('checked', false);\r\n\r\n        $('.logo .image-holder-wrapper').html(this.imagePlaceholder());\r\n        $('.banner .image-holder-wrapper').html(this.imagePlaceholder());\r\n\r\n        $('.btn-delete').addClass('hide');\r\n        $('.form-group .help-block').remove();\r\n\r\n        $('#category-form input[name=\"parent_id\"]').remove();\r\n\r\n        $('.general-information-tab a').click();\r\n    }\r\n\r\n    imagePlaceholder() {\r\n        return `\r\n            <div class=\"image-holder placeholder\">\r\n                <i class=\"fa fa-picture-o\"></i>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    loading(state) {\r\n        if (state === true) {\r\n            $('.overlay.loader').removeClass('hide');\r\n        } else {\r\n            $('.overlay.loader').addClass('hide');\r\n        }\r\n    }\r\n\r\n    submit(e) {\r\n        let selectedId = $('.category-tree').jstree('get_selected')[0];\r\n\r\n        if (! $('#slug-field').hasClass('hide')) {\r\n            window.form.appendHiddenInput('#category-form', '_method', 'put');\r\n\r\n            $('#category-form').attr('action', route('admin.categories.update', selectedId));\r\n        }\r\n\r\n        e.currentTarget.submit();\r\n    }\r\n}\r\n"],"names":["_default","categoryForm","selector","_this","_classCallCheck","this","$","jstree","defaults","dnd","touch","copy","fetchCategoryTree","on","e","node","fetchCategory","selected","data","updateCategoryTree","key","value","core","url","route","check_callback","plugins","_this2","loading","ajax","type","category_tree","getCategoryTree","success","_success","_x","apply","arguments","toString","message","error","_error","_x2","xhr","responseJSON","get_json","flat","reduce","formatted","category","concat","id","parent_id","parent","position","state","nodeElement","get_node","addClass","removeClass","tree","CategoryTree","collapseAll","expandAll","addRootCategory","addSubCategory","submit","window","admin","removeSubmitButtonOffsetOn","preventDefault","clear","setTimeout","selectedId","undefined","form","appendHiddenInput","_this3","update","removeErrors","remove","attr","val","name","slug","prop","is_searchable","is_active","html","categoryImage","logo","banner","fieldName","file","exists","path","imagePlaceholder","click","hasClass","currentTarget"],"sourceRoot":""}